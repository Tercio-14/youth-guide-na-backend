# RAG Pipeline Flow (Updated)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          User Query                                 â”‚
â”‚                     "I need a tech job"                             â”‚
â”‚                     Profile: {skills: ["IT", "Python"]}             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STAGE 1: Fast Retrieval                          â”‚
â”‚                    (TF-IDF + Cosine Similarity)                     â”‚
â”‚                                                                     â”‚
â”‚  â€¢ Retrieves top 20 candidates based on keyword matching           â”‚
â”‚  â€¢ Each has a cosineScore (0-1)                                    â”‚
â”‚  â€¢ Fast but not semantically aware                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               STAGE 2: AI Reranker (IMPROVED âœ¨)                    â”‚
â”‚                                                                     â”‚
â”‚  For each candidate:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LLM Scoring (NEW JSON FORMAT)                                â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚  â”‚
â”‚  â”‚ Input:                                                        â”‚  â”‚
â”‚  â”‚  â€¢ User Query: "I need a tech job"                           â”‚  â”‚
â”‚  â”‚  â€¢ User Profile: Skills=[IT, Python], Location=Windhoek      â”‚  â”‚
â”‚  â”‚  â€¢ Opportunity: "Python Developer at StartupNam"             â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚ Evaluation Criteria (NEW WEIGHTS):                           â”‚  â”‚
â”‚  â”‚  â€¢ Skill Match (30%) âœ“ Python â†” Python Developer            â”‚  â”‚
â”‚  â”‚  â€¢ Query Relevance (30%) âœ“ "tech job" â†” Developer           â”‚  â”‚
â”‚  â”‚  â€¢ Interest Alignment (20%) âœ“ IT interest                   â”‚  â”‚
â”‚  â”‚  â€¢ Location Fit (10%) âœ“ Windhoek                            â”‚  â”‚
â”‚  â”‚  â€¢ Type Match (10%) âœ“ Job type                              â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚ Output (NEW JSON):                                            â”‚  â”‚
â”‚  â”‚ {                                                             â”‚  â”‚
â”‚  â”‚   "score": 92,                                                â”‚  â”‚
â”‚  â”‚   "reasoning": "Excellent match - Python skill aligns with    â”‚  â”‚
â”‚  â”‚                developer role, Windhoek location matches"     â”‚  â”‚
â”‚  â”‚ }                                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Dynamic Scoring (NEW FORMULA âœ¨)                              â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚  â”‚
â”‚  â”‚ OLD: finalScore = (aiScore/100) * 0.7 + cosineScore * 0.3    â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚ NEW: finalScore = (aiScore ** 1.1) * 0.75 + cosineScore * 0.25â”‚ â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚ Example with aiScore=92, cosineScore=0.6:                    â”‚  â”‚
â”‚  â”‚  OLD: (92/100)*0.7 + 0.6*0.3 = 0.824                         â”‚  â”‚
â”‚  â”‚  NEW: (92**1.1)*0.75 + 0.6*0.25 = 1.099 (+33% boost!) ðŸš€     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  Result:                                                           â”‚
â”‚  {                                                                 â”‚
â”‚    ...opportunity,                                                 â”‚
â”‚    aiScore: 92,                                                    â”‚
â”‚    aiReasoning: "Excellent match...",  // NEW!                     â”‚
â”‚    stage1Score: 0.6,                                               â”‚
â”‚    finalScore: 1.099                   // NEW FORMULA!             â”‚
â”‚  }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Sort & Filter Top 5                              â”‚
â”‚                                                                     â”‚
â”‚  â€¢ Filter: aiScore >= 30 (minimum threshold)                       â”‚
â”‚  â€¢ Sort: By finalScore (descending)                                â”‚
â”‚  â€¢ Take: Top 5 results                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STAGE 3: Chat Response Generation (IMPROVED âœ¨)        â”‚
â”‚                                                                     â”‚
â”‚  System Prompt (NEW - FACTUAL & CONCISE):                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Core Principles:                                              â”‚  â”‚
â”‚  â”‚ 1. Factual & Grounded - Only verified opportunities          â”‚  â”‚
â”‚  â”‚ 2. Short & Direct - Under 50 words                           â”‚  â”‚
â”‚  â”‚ 3. Personalized - Explain WHY matches fit                    â”‚  â”‚
â”‚  â”‚ 4. Youth-Friendly - Like a supportive older sibling          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  Input:                                                            â”‚
â”‚  â€¢ User query: "I need a tech job"                                â”‚
â”‚  â€¢ Profile: Skills=[IT, Python], Location=Windhoek                â”‚
â”‚  â€¢ Top 5 opportunities (with aiReasoning!)                        â”‚
â”‚                                                                     â”‚
â”‚  Generated Response:                                               â”‚
â”‚  "I found 3 developer roles that match your Python and IT         â”‚
â”‚  skills! Two are in Windhoek near you, and one offers remote      â”‚
â”‚  work. Check them out below ðŸ‘‡"                                    â”‚
â”‚                                                                     â”‚
â”‚  Word count: 28 words âœ“ (under 50-word limit)                     â”‚
â”‚  Personalized: âœ“ Mentions Python, IT, Windhoek                    â”‚
â”‚  Factual: âœ“ Based only on retrieved opportunities                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Response to User                              â”‚
â”‚                                                                     â”‚
â”‚  {                                                                 â”‚
â”‚    "message": "I found 3 developer roles...",                      â”‚
â”‚    "opportunities": [                                              â”‚
â”‚      {                                                             â”‚
â”‚        "title": "Python Developer",                                â”‚
â”‚        "organization": "StartupNam",                               â”‚
â”‚        "location": "Windhoek",                                     â”‚
â”‚        "aiScore": 92,                                              â”‚
â”‚        "aiReasoning": "Excellent match - Python skill aligns..."   â”‚
â”‚      },                                                            â”‚
â”‚      ...                                                           â”‚
â”‚    ]                                                               â”‚
â”‚  }                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Improvements Summary

### 1. **Reranker Prompt** â†’ Structured JSON with reasoning
   - **Before**: "Respond with ONLY a number from 0-100"
   - **After**: JSON with score + reasoning
   - **Benefit**: Transparency and explainability

### 2. **Scoring Formula** â†’ Exponential boost for quality
   - **Before**: Linear blend (70% AI, 30% cosine)
   - **After**: Exponential boost + 75/25 split
   - **Benefit**: High-quality matches dominate results

### 3. **Generation Prompt** â†’ Factual and concise
   - **Before**: 60-word limit, 7 guidelines, example-heavy
   - **After**: 50-word limit, 4 principles, youth-focused
   - **Benefit**: Shorter, more grounded responses

---

## Impact Visualization

```
Score Distribution (Example with 20 candidates)

OLD Formula:                    NEW Formula:
finalScore range: 0.3-0.9       finalScore range: 0.4-1.1

  |                                |        â–ˆâ–ˆ
  |                                |      â–ˆâ–ˆâ–ˆâ–ˆ
  |        â–ˆâ–ˆ                      |    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  |      â–ˆâ–ˆâ–ˆâ–ˆ                      |  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  |    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                      |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  |  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                      |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                    |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  +â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   +â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Low    High                      Low         High

Result: Better separation         Result: Excellent matches
between mediocre and good          clearly stand out (>1.0)
